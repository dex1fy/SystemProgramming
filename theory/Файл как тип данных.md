## Файл как тип данных. Использование файлов в работе программного обеспечения.

**Файл в программировании — это "блокнот для данных" на диске.**

---

### **Что такое файл?**

Это именованная область на диске для хранения данных. Программа может:
- **Читать** из файла (как читать из блокнота)
- **Писать** в файл (как писать в блокнот)
- **Искать** в файле (как листать страницы)

---

### **Три типа файлов:**

#### **1. Текстовые файлы (.txt, .c, .py)**
```c
// Содержат текст, читаются строками
Hello World
This is text
```

#### **2. Бинарные файлы (.exe, .jpg, .mp3)**
```c
// Содержат любые данные (картинки, звук, программы)
// Читаются побайтово
```

#### **3. Специальные файлы**
- **stdin** (стандартный ввод) — что вводит пользователь
- **stdout** (стандартный вывод) — что видит пользователь  
- **stderr** (стандартный вывод ошибок) — куда пишутся ошибки

---

### **Как работать с файлами в Си:**

#### **1. Открыть файл (получить доступ)**
```c
FILE* file = fopen("данные.txt", "режим");
// file — дескриптор файла (номерок в гардеробе)
```

**Режимы открытия:**
- `"r"` — чтение (файл должен существовать)
- `"w"` — запись (создаст или перезапишет)
- `"a"` — добавление в конец
- `"r+"` — чтение и запись
- `"rb"`, `"wb"` — для бинарных файлов

#### **2. Прочитать из файла**
```c
// Чтение строки
char строка[100];
fgets(строка, 100, file);

// Чтение форматированное (как scanf из файла)
int число;
fscanf(file, "%d", &число);

// Чтение символа
char символ = fgetc(file);
```

#### **3. Записать в файл**
```c
// Запись строки
fprintf(file, "Строка: %s\n", текст);

// Запись символа
fputc('A', file);

// Запись форматированная
fprintf(file, "Число: %d\n", 42);
```

#### **4. Закрыть файл (ОБЯЗАТЕЛЬНО!)**
```c
fclose(file);  // Как вернуть номерок в гардеробе
// Если не закрыть — могут быть проблемы
```

---

### **Пример: копирование файла**
```c
#include <stdio.h>

int main() {
    FILE* исходник = fopen("вход.txt", "r");
    FILE* копия = fopen("выход.txt", "w");
    
    if (исходник == NULL || копия == NULL) {
        printf("Ошибка открытия файла\n");
        return 1;
    }
    
    // Копируем посимвольно
    int символ;
    while ((символ = fgetc(исходник)) != EOF) {
        fputc(символ, копия);
    }
    
    fclose(исходник);
    fclose(копия);
    
    printf("Файл скопирован\n");
    return 0;
}
```

---

### **Зачем файлы нужны программам?**

#### **1. Сохранить данные между запусками**
```c
// Игра сохраняет прогресс
// Программа 1: записывает в файл
FILE* save = fopen("save.dat", "wb");
fwrite(&уровень, sizeof(int), 1, save);
fwrite(&здоровье, sizeof(int), 1, save);
fclose(save);

// Программа 2: читает при следующем запуске
FILE* load = fopen("save.dat", "rb");
fread(&уровень, sizeof(int), 1, load);
fread(&здоровье, sizeof(int), 1, load);
fclose(load);
```

#### **2. Конфигурация программы**
```c
// config.ini:
// username=Иван
// theme=dark
// language=ru

// Программа читает настройки при запуске
```

#### **3. Логирование (запись событий)**
```c
void log_event(const char* сообщение) {
    FILE* log = fopen("app.log", "a");  // Добавляем в конец
    fprintf(log, "%s: %s\n", current_time(), сообщение);
    fclose(log);
}

// В программе:
log_event("Программа запущена");
log_event("Пользователь нажал кнопку");
```

#### **4. Обмен данными между программами**
```c
// Программа A пишет данные
// Программа B читает те же данные
// Не нужно держать обе программы запущенными одновременно
```

---

### **Особенности работы с файлами:**

#### **1. Проверка ошибок (ОБЯЗАТЕЛЬНО!)**
```c
FILE* f = fopen("файл.txt", "r");
if (f == NULL) {
    perror("Ошибка открытия");  // Напечатает что пошло не так
    return 1;
}
```

#### **2. Позиция в файле (курсор)**
```c
// Каждый файл имеет "курсор" — где сейчас читаем/пишем
fseek(file, 10, SEEK_SET);  // Переместить на 10-й байт от начала
fseek(file, -5, SEEK_CUR);  // На 5 байт назад от текущей позиции
fseek(file, 0, SEEK_END);   // В конец файла

long позиция = ftell(file);  // Узнать текущую позицию
```

#### **3. Буферизация (кэширование)**
```c
// Данные сначала пишутся в буфер в памяти
// Потом сбрасываются на диск
fflush(file);  // Принудительно сбросить буфер на диск
```

---

### **Пример: дневник с паролем**
```c
#include <stdio.h>
#include <string.h>

int main() {
    char пароль[50];
    char запись[200];
    
    // Читаем пароль из файла
    FILE* pass_file = fopen("password.txt", "r");
    if (pass_file == NULL) {
        printf("Создайте пароль: ");
        scanf("%s", пароль);
        pass_file = fopen("password.txt", "w");
        fprintf(pass_file, "%s", пароль);
        fclose(pass_file);
    } else {
        fscanf(pass_file, "%s", пароль);
        fclose(pass_file);
    }
    
    // Проверяем пароль
    char ввод[50];
    printf("Введите пароль: ");
    scanf("%s", ввод);
    
    if (strcmp(ввод, пароль) != 0) {
        printf("Неверный пароль!\n");
        return 1;
    }
    
    // Добавляем запись в дневник
    FILE* diary = fopen("diary.txt", "a");
    printf("Введите запись: ");
    getchar();  // Убираем \n от предыдущего scanf
    fgets(запись, 200, stdin);
    
    fprintf(diary, "Запись: %s", запись);
    fclose(diary);
    
    printf("Запись сохранена!\n");
    return 0;
}
```

---

### **Текстовые vs Бинарные файлы:**

| **Текстовые** | **Бинарные** |
|--------------|--------------|
| Читаются строками | Читаются блоками байт |
| Перенос строки преобразуется | Байты как есть |
| Для человека | Для программ |
| `.txt`, `.csv`, `.html` | `.exe`, `.jpg`, `.dat` |

```c
// Запись структуры в бинарный файл
struct Player {
    char name[50];
    int score;
    float position[3];
};

struct Player p = {"Иван", 100, {1.0, 2.0, 3.0}};
FILE* f = fopen("save.bin", "wb");
fwrite(&p, sizeof(struct Player), 1, f);  // Записали всю структуру сразу
fclose(f);
```

---

### **Ошибки новичков:**

#### **1. Не проверяют открытие файла**
```c
FILE* f = fopen("файл.txt", "r");
// Сразу начинают читать... а если файла нет?
```

#### **2. Забывают закрыть файл**
```c
fopen(...);
// ... много кода ...
// Забыли fclose() → утечка ресурсов
```

#### **3. Путают режимы**
```c
fopen("файл.txt", "r");  // Читать существующий
fopen("файл.txt", "w");  // Создать новый (удалит старый!)
```

---

### **Главные правила:**

1. **Всегда проверяйте** результат `fopen()`
2. **Всегда закрывайте** файлы `fclose()`
3. **Выбирайте правильный режим** (чтение/запись/добавление)
4. **Для больших файлов** читайте блоками, не целиком
5. **Используйте буферизацию** для скорости

---

### **Итог:**
**Файлы — это долговременная память программ.** Они позволяют сохранять данные между запусками, настраивать программы, вести логи и обмениваться данными между приложениями. Работа с файлами — базовая операция для любой серьёзной программы.