## Назначение реестра Windows. Особенности использования системного реестра программами. Структура системного реестра. Типы данных в системном реестре.


**Реестр Windows — это "единый блокнот с настройками" всей системы.**

---

### **Зачем он нужен? (Назначение)**

1. **Запоминает настройки Windows**
   - Как выглядит рабочий стол
   - Какие программы запускать при включении
   - Где лежат важные файлы

2. **Хранит настройки программ**
   - Где вы сохраняли документы в Word
   - Какой язык выбран в браузере
   - Лицензионные ключи программ

3. **Знает про всё железо**
   - Какая видеокарта установлена
   - Какой принтер подключен
   - Какие драйверы нужны

**Проще:** Если компьютер — квартира, то реестр — **единая записная книжка**, где записано:
- Где что лежит (программы, документы)
- Кому какие ключи (права доступа)
- Что включать при входе (автозагрузка)

---

### **Как программы им пользуются?**

#### **Программа при запуске:**
1. **Открывает реестр** (как открывают блокнот)
2. **Ищет свои настройки** (листает до своей страницы)
3. **Читает:** "пользователь любит тёмную тему", "сохранять файлы в папку Документы"
4. **Записывает новые настройки** при изменении
5. **Закрывает реестр**

#### **Пример: Браузер Chrome**
```c
// Псевдокод того, что делает Chrome:
1. Открыть реестр
2. Найти: HKEY_CURRENT_USER\Software\Google\Chrome
3. Прочитать: "HomePage" = "https://google.com"
4. Прочитать: "DefaultZoom" = 100
5. Закрыть реестр
6. Открыть страницу google.com с масштабом 100%
```

#### **Что можно делать через реестр:**
- **Узнать** путь к папке "Мои документы"
- **Поменять** иконку для файлов .txt
- **Добавить** программу в автозагрузку
- **Узнать** серийный номер Windows

---

### **Структура реестра (5 главных разделов)**

Представьте **большой книжный шкаф** с 5 полками:

1. **HKCR (Classes Root)** — "Каталог файлов"
   - Какие программы открывают .doc, .jpg, .mp3
   - Значки для разных типов файлов

2. **HKCU (Current User)** — "Личные настройки"
   - Всё, что настроил ТЕКУЩИЙ пользователь
   - Фон рабочего стола, пароли, настройки программ

3. **HKLM (Local Machine)** — "Настройки компьютера"
   - Всё, что касается ВСЕХ пользователей
   - Установленные программы, драйверы, службы

4. **HKU (Users)** — "Все пользователи"
   - Настройки КАЖДОГО пользователя компьютера
   - Как будто много маленьких HKCU

5. **HKCC (Current Config)** — "Текущее железо"
   - Настройки монитора, принтера, сети
   - То, что подключено прямо сейчас

---

### **Что там внутри? (Типы записей)**

В каждом разделе есть:

1. **Ключи (Keys)** — как папки
   ```
   HKCU\Software\Microsoft\Windows\
   \______/\______/\________/\______/
   Раздел  Папка   Папка     Папка
   ```

2. **Параметры (Values)** — как файлы в папках, бывают:

#### **а) REG_SZ — обычный текст**
```
"Имя пользователя" = "Анна"
"Путь к программе" = "C:\Program Files\App\"
```

#### **б) REG_DWORD — число**
```
"Ширина экрана" = 1920
"Включить звук" = 1  (1 = да, 0 = нет)
```

#### **в) REG_BINARY — двоичные данные**
```
"Хеш пароля" = 3A 7F B2 00
"Настройки драйвера" = [байты]
```

#### **г) REG_MULTI_SZ — несколько строк**
```
"Поиск в папках" = "C:\Windows" "C:\Program Files" ""
```

#### **д) REG_EXPAND_SZ — текст с подстановкой**
```
"Временные файлы" = "%TEMP%\cache"
// %TEMP% заменится на C:\Users\Анна\AppData\Local\Temp
```

---

### **Как это выглядит в реальности?**

**Путь в реестре:**
```
HKEY_CURRENT_USER\Control Panel\Desktop
```

**Что там может быть:**
```
Wallpaper = "C:\Windows\web\wallpaper\img1.jpg"  (REG_SZ)
WallpaperStyle = 2                                (REG_DWORD)
```

**В программе на C:**
```c
// Прочитать обои рабочего стола
HKEY hKey;
char wallpaper[256];
DWORD size = 256;

// 1. Открыть раздел
RegOpenKeyEx(HKEY_CURRENT_USER, "Control Panel\\Desktop", 0, KEY_READ, &hKey);

// 2. Прочитать значение
RegQueryValueEx(hKey, "Wallpaper", NULL, NULL, (BYTE*)wallpaper, &size);

// 3. Закрыть
RegCloseKey(hKey);

// Теперь wallpaper = "C:\Windows\web\wallpaper\img1.jpg"
```

---

### **Важные правила для программ:**

1. **Читай при запуске** — узнать свои настройки
2. **Пиши при изменении** — сохранить новые настройки
3. **Не храни большие файлы** — только настройки
4. **Удаляй за собой** при удалении программы
5. **Не лезь в чужие разделы** без разрешения

---

### **Примеры из жизни:**

1. **Вы поменяли обои рабочего стола**
   → Windows записала в реестр: `HKCU\Control Panel\Desktop\Wallpaper = "новые_обои.jpg"`

2. **Вы установили программу**
   → Она записала в реестр: `HKLM\Software\МояПрограмма\InstallPath = "C:\Program Files\МояПрограмма\"`

3. **Вы нажали "Открыть с помощью" для файла .pdf**
   → Windows записала в реестр: `HKCR\.pdf = "AcroExch.Document"`

---

### **Опасности реестра:**

1. **Вирусы** прописываются в автозагрузку:
   ```
   HKLM\Software\Microsoft\Windows\CurrentVersion\Run\Virus = "virus.exe"
   ```

2. **Мусор** от удалённых программ:
   → Программу удалили, а записи в реестре остались

3. **Ошибки** при ручном редактировании:
   → Удалили не ту запись → Windows не загружается

---

### **Основные тезисы:**

**Реестр Windows — это:**
1. **Единое место** для всех настроек
2. **Структура:** 5 главных разделов (HKCU, HKLM и т.д.)
3. **Данные:** Текст (REG_SZ), числа (REG_DWORD), байты (REG_BINARY)
4. **Использование:** Программы читают/пишут через специальные команды
5. **Цель:** Чтобы программы помнили свои настройки между запусками

**Запомните:** Реестр — это **записная книжка системы**, а не **склад для файлов**. Храните там только важные настройки.